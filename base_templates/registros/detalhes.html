{% extends "base.html" %}

{% block title %}Detalhes do Registro{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h1>Registro {{ registro.pk }}</h1>
    </div>
    <div class="card-body">
        <p><strong>Linha:</strong> {{ registro.linha.nome }}</p>
        <p><strong>Data:</strong> {{ registro.data }}</p>
        <p><strong>Turno:</strong> {{ registro.turno }}</p>

        <p><strong>Produzido:</strong> {{ total_produzido }}</p>
        <p><strong>Defeituoso:</strong> {{ total_defeituoso }}</p>
        <p><strong>Tempo parado:</strong> {{ tempo_parado_total }} min</p>
        <p><strong>Motivo(s):</strong>
            {% if motivos_paradas and motivos_paradas|length > 0 %}
                {{ motivos_paradas|join:", " }}
            {% else %}
                —
            {% endif %}
        </p>

        <p><strong>Status:</strong> {{ registro.finalizada|yesno:"Finalizado,Pendente" }}</p>

        <h2>Produção hora a hora</h2>
        {% if producao_hora %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Hora Início</th>
                    <th>Hora Fim</th>
                    <th>Produzido</th>
                    <th>Defeituoso</th>
                    <th>Taxa (%)</th>
                </tr>
            </thead>
            <tbody>
                {% for hora in producao_hora %}
                <tr>
                    <td>{{ hora.hora_inicio }}</td>
                    <td>{{ hora.hora_fim }}</td>
                    <td>{{ hora.quantidade_produzida }}</td>
                    <td>{{ hora.quantidade_defeituosa }}</td>
                    <td>{{ hora.taxa_defeitos|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>Nenhum registro hora a hora encontrado.</p>
        {% endif %}

        <h2>Paradas</h2>
        {% if paradas %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Hora Início</th>
                    <th>Hora Fim</th>
                    <th>Duração (min)</th>
                    <th>Motivo</th>
                </tr>
            </thead>
            <tbody>
                {% for parada in paradas %}
                <tr>
                    <td>{{ parada.hora_inicio }}</td>
                    <td>{{ parada.hora_fim }}</td>
                    <td>{{ parada.duracao }}</td>
                    <td>{{ parada.motivo }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>Nenhuma parada registrada.</p>
        {% endif %}

        <a href="{% url 'registros-editar' registro.pk %}" class="button">Editar</a>
        <a href="{% url 'registros-lista' %}" class="button">Voltar</a>
    </div>
</div>
{% endblock %}
